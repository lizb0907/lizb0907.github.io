---
layout: post
title: JVM调优使用工具
categories: Jvm
description: JVM调优使用工具
keywords: JVM,TOOls
---

JVM调优使用工具

**目录**

* TOC
{:toc}

## JDK内置工具

### 1.分类

```sh
大体分为：
    1.监控类工具：jps, jstat
    2.故障排查工具:
      jinfo, jmap, jstack, jcmd,
      jhat, jhsdb
    3.可视化工具:jconsole,visualvm,jhsdb
```

### 2.jps主要监控进程

```sh
参考文档：
  java 8 ：https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jps.html

使用说明:
  1. 直接键入 jps  //显示java进程
  2. jps -m       //显示传入main方法参数
  3. jps -ml      //显示传入main方法参数，同时显示启动类包名
  4. jps -v       //显示传递给jvm的参数

jps 命令有点类似 ps -ef | grep java 命令，
但 jps 命令显示的格式更友好。 

jps还可以查看远程服务器的jvm进程信息，需要一些配置，使用rmi协议
        jps -l remote.domain //端口1099
        jps -l rmi://remote.comain:1231
```

### 3.jstat监控jvm各种运行状态

![](/images/posts/jvm/jvm-tools/1.png)

如同，红色框内就是列标题，很重要！

```sh
参考文档：
  java 8 : https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html

使用说明:
  格式：jstat [ generalOption | outputOptions vmid [ interval[s|ms] [ count ] ]

  generalOption可选参数如下：
    1.class       //显示类加载器的统计信息
    2.compiler    //显示有关jvm即时编译器行为的统计信息
    3.gc          //显示有关垃圾收集堆行为的统计信息
    4.gccause     //显示引起垃圾收集事件的原因
    ...

  outputOptions:
    1.-t           //将时间戳显示为输出的第一列
    2.-hn          //n为第几次，表示n次采样后输出一次列标题

  vmid：           //进程的唯一标识

  interval：       //间隔多长时间输出1次

  count:           //输出多少次后退出

例子：
  jstat -gc -t -h3 26000 1000 10
  每隔1000毫秒输出一次gc统计信息，输出10次退出，同时将时间戳显示为输出的第一列，每3次
  采样后输出一次列标题。
  gc列标题含义(官网上都有详细说明):
    S0C：第一个幸存区的大小
    S1C：第二个幸存区的大小
    S0U：第一个幸存区的使用大小
    S1U：第二个幸存区的使用大小
    EC：eden的大小
    EU：eden使用大小
    OC：老年代大小
    OU：老年代使用大小
    MC：方法区大小
    MU：方法区使用大小
    CCSC:压缩类空间大小
    CCSU:压缩类空间使用大小
    YGC：年轻代垃圾回收次数
    YGCT：年轻代垃圾回收消耗时间
    FGC：老年代垃圾回收次数
    FGCT：老年代垃圾回收消耗时间
    GCT：垃圾回收消耗总时间
```

```sh
使用jstat看G1的时候，s0永远是0：
  因为G1的堆布局跟HotSpot VM里其它GC不一样——它只有一组逻辑上的survivor space，
  而不像其它HotSpot GC一样有两段明确、固定的地址空间用作survivor space——所以用jstat
  看G1的话肯定是survivor space 0显示0%，survivor space 1显示100%。这个是正常的。

G1在初始化jstat用的计数器的时候就指定了s0永远是0:
  //  name "generation.0.space.1"  
  // See _old_space_counters for additional counters  
  // Set the arguments to indicate that this survivor space is not used.  
  _from_counters = new HSpaceCounters("s0", 1 /* ordinal */,  
  pad_capacity(0) /* max_capacity */,  
  pad_capacity(0) /* init_capacity */,  
  _young_collection_counters);  

  //  name "generation.0.space.2"  
  // See _old_space_counters for additional counters  
  _to_counters = new HSpaceCounters("s1", 2 /* ordinal */,  
  pad_capacity(overall_reserved()) /* max_capacity */,  
  pad_capacity(survivor_space_committed()) /* init_capacity */,  
  _young_collection_counters);  

来源R大帖子回复（https://hllvm-group.iteye.com/group/topic/42352）
```

## 一些好的jvm调优链接

### 1.G1调优官方指南必看：

http://www.oracle.com/technetwork/articles/java/g1gc-1984535.html

### 2.不错的博客系列

jvm调优1-4：
https://www.cnblogs.com/chiangchou/p/jvm-1.html
https://www.cnblogs.com/chiangchou/p/jvm-2.html
https://www.cnblogs.com/chiangchou/p/jvm-3.html
https://www.cnblogs.com/chiangchou/p/jvm-4.html#_label3
