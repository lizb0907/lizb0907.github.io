---
layout: post
title: ZGC-颜色指针(03)
categories: Jvm
description: ZGC-颜色指针(03)
keywords: JVM,ZGC
---

ZGC-颜色指针(03)

**目录**

* TOC
{:toc}

## 什么是颜色指针？

```sh
1.颜色指针是ZGC的一个核心概念，它使ZGC能够查找、标记、定位和重映射对象。

2.不支持32位平台。

3.不支持压缩Oops。

4.实现需要虚拟地址屏蔽，这可以在硬件、操作系统或软件上实现。

5.有些文章会将其定义为是一种将信息存储在指针中的技术。
```

## 指针布局

![](/images/posts/jvm/ZGC/1.png)

```sh
上图显示了64位指针布局：
   1.低42位：
        .用于描述对象地址（也就是应用程序可以使用的堆空间，java堆）。
        .42位地址最大寻址空间就是4TB，这就是ZGC一直宣称自己最大支持4TB内存原因(未来可扩展)。
     设系统地址总线为N位，则最大寻址空间 = 2^N Byte
     例如32位地址线，最大寻址空间为：
        .2^32 Byte =4294967196Byte = 4197304kByte =4096MByte =4GB
        .1太字节(tb)=1024 千兆字节(GB)
   
   2.颜色指针（虚拟内存）:
        .1-bit: Marked0      [4TB ~ 8TB) 称为M0地址空间
        .1-bit: Marked1      [8TB ~ 12TB) 称为M1地址空间
        .1-bit: Remapped      [16TB ~ 20TB) 称为Remapped空间 （注意：从16TB开始）
        .1-bit: 预留          [12TB ~ 16TB)  预留未使用

   3.高18位：
        预留
```

![](/images/posts/jvm/ZGC/2.png)

```sh
1.当应用程序创建对象时，首先在堆空间申请一个虚拟地址，但该虚拟地址并不会映射到真正的物理地址，
  而是映射到三个视图（M0、M1和Remapped），然后通过三视图映射到真正的物理空间。

2.ZGC也会为M0、M1和Remapped分别申请一个虚拟地址，且这三个虚拟地址对应同一个物理地址，
  但这三个空间在同一时间有且只有一个空间有效。
```