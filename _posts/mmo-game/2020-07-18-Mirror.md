---
layout: post
title: 镜像模块
categories: Mmo-Game
description: 镜像模块记录
keywords: mirror, ai
---
mirror镜像模块，主要学习AI逻辑

**目录**

* TOC
{:toc}

## 什么是镜像？

拥有玩家性质的生物角色就是镜像，类似copy一份玩家，

不是真正的玩家，类似机器人，拥有玩家的技能、名字、外貌...

## 类继承关系

### 1.类图

![](/images/posts/mmo_game/mirror1.jpg)

### 2.所有状态机抽象类AbstractAIState

```java
/**
 * 状态机抽象类
 * 
 * @author wangguohao
 * @time 2017年7月6日 - 下午5:00:08
 */
public abstract class AbstractAIState<E extends AbstractCharacter>
{
    ...
    /**
	 * 当前状态可转换的状态
	 */
	protected EnumSet<StateEnum> transitionState = EnumSet.noneOf(StateEnum.class);
    ...

    /**
     * 判断是否可以进入此状态
     * @param e
     * @return
     */
	public boolean canEnter(E e)
    {
        return true;
    }

    /**
	 * 进入当前状态要做的事
	 * @param e
	 * @return
	 */
	public abstract boolean enter(E e);

    /**
     * 判断是否可以退出此状态
     * @param e
     * @return
     */
    public boolean canExit(E e)
    {
        return true;
    }

	/**
	 * 退出当前状态要做的事
	 * @param e
	 * @return
	 */
	public abstract boolean exit(E e);

    ...

}
```
所有状态机的抽象父类，

镜像、npc、傀儡...状态机的实现都是继承自AbstractAIState。

AbstractAIState<E extends AbstractCharacter>, 

传入对象必须是继承AbstractCharacter，拥有生物类属性的对象。

抽象一些方法，判断是否可以进入此状态、进入当前状态要做的事..., 子类各自覆写实现。


### 3.镜像抽象类AbstractMirrorAIState


### 2.AI初始化

```java
BPCopySceneFightArenaGame：
@Override
public void onActorEnter(Actor actor)
{
    ...
    ...
    //初始化镜像数据
    Mirror mirror = new Mirror(mirrorData);
    mirror.init();

    //添加镜像到场景
    addBPObject(mirror);
    ...
    ...

}
```
比武小游戏场景，玩家添加进场景是，顺带将镜像初始化mirror.init()，并添加到场景。
