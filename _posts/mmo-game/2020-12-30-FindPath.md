---
layout: post
title: 游戏服务器寻路
categories: Mmo-Game
description: 游戏服务器寻路
keywords: 游戏，寻路
---

游戏服务器寻路

**目录**

* TOC
{:toc}

## 一些需要掌握的数学知识

### 1.向量叉乘

```sh
1．向量叉乘

点1(x1,y1),点2(x2,y2),点3(x3,y3),点4(x4,y4)

向量a=(xa,ya)=(x2-x1,y2-y1)

向量b=(xb,yb)=(x4-x3,y4-y3)

向量叉乘c=a*b=xa*yb-xb*ya=( x2-x1)*( y4-y3)-( x4-x3)*( y2-y1)

c>0表示向量a到向量b夹角小于180度

c=0表示向量a和向量b平行或者在一条直线上

C<0表示向量a到向量b的夹角大于180度
```

如下图:

![](/images/posts/mmo_game/findpath/1.png)

### 2.A*算法

![](/images/posts/mmo_game/findpath/2.png)

```sh
1.公式：f = g + h
     f：代价
     g: 从起点走到当前点已经付出的代价
     h: 从当前点走到终点预计要付出的代价

2.假设设置（代价可以适当设置）：
     直线走一格代价：10
     斜线走一格代价：14
     最好比例和上面差不多（需要差不多满足勾股定理），
     防止出现指向走2个格子大于斜线2个格子。
```

```sh
g值的计算：
    红色起点周围的g值大小

        14   10    14

        10  start  10

        14   10    14
```

![](/images/posts/mmo_game/findpath/3.png)

```sh
h值的计算：
   只计算直线距离（这个直线不是两点直接的直线，而是说走格子直线，不走格子斜线），并无视障碍。


   计算红色起点周围8个点的h值大小：

        190   180    170

        180  start   160

        170   160    150
```

```sh
f值的计算：
   红色为起点，周围的f值就等于上面的 g + h

        204   190    184

        190  start   170

        184   170    164

    所以我们走f代价最小的格子，就是154格子（2，2）,
    右下角走是最快。
```

```sh
1.同理，如果当前点变为了(2,2), 继续算出周围的f代价。

2.特别注意g值为从起点走到当前点已经付出的代价！！是个累计值！！
从起点（1，1）走到了当前点（2，2），已经耗费了g值是14。接下来是
从（2，2）点作为起点开始计算。

3.所以（2，2）点周围的g值：

        28      24     28

        24   （2，2）   24

        28      24     28
    
4.计算（2，2）点周围的h值：
  
        170     160    150

        160   （2，2）   140

        150     140     130
```