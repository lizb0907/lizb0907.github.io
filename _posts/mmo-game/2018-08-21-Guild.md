---
layout: post
title: 帮派开发
categories: mmo-game
description: 帮派开发小计
keywords: java游戏服务端，mmo，game
---

帮派作为大功能模块之一，其中承载了相当多的玩法和养成内容

**目录**

* TOC
{:toc}

## 帮派

### 一：创建帮派

#### 1.前端发起协议

```java
// 创建帮派
message CSGuildCreate{
    required string name = 1; // 帮派名称
    required string notice = 2; // 帮派宣言
    required int32 label = 3; // 帮派标签
}
```

```java
/**
* 创建帮派
*
* @param name   帮派名字
* @param notice 帮派宣言
* @param label  标签
*/
public void guildCreate(String name, String notice, int label)
{
    ...
    ...
    玩家等级校验

    帮派名字长度校验

    宣言长度校验

     // 校验屏蔽字，字符串长度，检查并扣除消耗，有问题直接给客户端飘错
    if (ChatUtils.containsName(name))
    {
        // 帮派名字中含有屏蔽字
        sendError(BPErrorCodeEnum.GUILD_NAME_HAVE_SENSITIVE_WORD);
        return;
    }

    if (ChatUtils.containsName(notice))
    {
        // 帮派宣言中含有屏蔽字
        sendError(BPErrorCodeEnum.GUILD_NOTICE_HAVE_SENSITIVE_WORD);
        return;
    }

    if (StringUtils.isPureDigital(name))
    {
        // 帮派名字不能是纯数字
        sendError(BPErrorCodeEnum.GUILD_NAME_NOT_ALL_NUMBER);
        return;
    }

    玩家货币消耗校验

    校验成功，发送世界

    ...
    ...
}
```
分析：校验成功，发送世界创建帮派。 特别注意这里的屏蔽字校验和是否纯数字的方法，
有时间需要单独细看，屏蔽字校验调用的是聊天接口采用的AC过滤算法。

#### 2.世界帮派创建
```java
/**
* 创建帮派
*
* @param actorID 玩家id
* @param name    帮派名字
* @param notice  帮派宣言
* @param label   帮派标签
* @param showParts   外显部件组
*/
public void guildCreate(long actorID, String name, String notice, int label, int[] showParts)
{
    ...
    ...
    从世界缓存里，判断当前创建玩家是否已经有帮派

    校验本服帮派数量是否满

    迭代全服所有帮派数据判断帮派名是否重复

    获取帮派序列id

    激活一个新的帮派场景

    构建帮派基本数据到世界内存

    通知帮派场景初始化

    添加帮派建筑数据

    添加初始帮派基金

    计算所有帮派装备总评分

    添加帮派创建事件

    添加到帮派成员列表

    给scene发消息，发给创建玩家

    添加到排行榜
}
```

#### 3.激活一个新的帮派场景



## 校验是否纯数字

### 1.采用java正则表达式

引入java.util.regex.Pattern包
```java
public class StringUtils
{
    private static final Pattern PURE_DIGITAL_PATTERN = Pattern.compile("[0-9]*");

    /**
	 * 判断字符串是否是纯数字
	 *
	 * @param value 要检验的字符串
	 * @return true:纯数字 false：否
	 */
	public static boolean isPureDigital(String value)
	{
        return PURE_DIGITAL_PATTERN.matcher(value).matches();
	}
}
```

